@page "/users"
@using ClothsStoreSys.Data
@using ClothsStoreSys.Models
@layout ClothsStoreSys.Shared.AdminLayout
@attribute [Authorize(Roles = "Admin")]
@inject AppDbContext Db
@inject NavigationManager NavigationManager
@inject Microsoft.Extensions.Localization.IStringLocalizer<ClothsStoreSys.SharedResources> L

<PageTitle>@L["Users"]</PageTitle>
<h3>@L["Users"]</h3>

<button class="btn btn-primary mb-2" @onclick="NewUser">@L["CreateCashier"]</button>
<table class="table">
    <thead><tr><th>@L["Username"]</th><th>@L["Role"]</th><th>@L["Active"]</th><th></th></tr></thead>
    <tbody>
        @foreach(var u in Db.Users)
        {
            <tr>
                <td>@u.Username</td>
                <td>@u.Role</td>
                <td>@(u.PasswordHash != "disabled")</td>
                <td>
                    <button class="btn btn-sm btn-warning" @onclick="() => ToggleActive(u.Id)">@((u.PasswordHash == "disabled") ? L["Activate"].Value : L["Deactivate"].Value)</button>
                </td>
            </tr>
        }
    </tbody>
</table>

@code {
    void NewUser()
    {
        NavigationManager.NavigateTo("/users/new");
    }

    void ToggleActive(int id)
    {
        var u = Db.Users.FirstOrDefault(x => x.Id == id);
        if (u is null) return;
        if (u.PasswordHash == "disabled") u.PasswordHash = "cashier"; else u.PasswordHash = "disabled";
        Db.SaveChanges();
    }
}
